// Simple wrapper around SJCL's ECC Implementation - v0.1.0 - https://github.com/jpillora/eccjs
// Jaime Pillora <dev@jpillora.com> - MIT/BSD(sljc) Copyright 2013
!function(a,b){"use strict";function c(a){var b=f.ecc[a];if(!b)throw new Error("Missing ECC algorithm: "+a);return{generate:function(a){return b.generateKeys(a,1)},importPublicHex:function(a,c){return a=f.ecc.curves["c"+a],new b.publicKey(a,f.codec.hex.toBits(c))},importSecretHex:function(a,c){return a=f.ecc.curves["c"+a],new b.secretKey(a,new f.bn(c))}}}function d(a){var b=f.hash[a];if(!b)throw new Error("Missing hash algorithm: "+a);return{hash:function(a){return b.hash(a)}}}function e(){this.k={},this.enck={},this.deck={},this.verk={}}var f={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message},this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message},this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message},this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message},this.message=a}}};f.cipher.aes=function(a){this._tables[0][0][0]||this._precompute();var b,c,d,e,g,h=this._tables[0][4],i=this._tables[1],j=a.length,k=1;if(4!==j&&6!==j&&8!==j)throw new f.exception.invalid("invalid aes key size");for(this._key=[e=a.slice(0),g=[]],b=j;4*j+28>b;b++)d=e[b-1],(b%j===0||8===j&&b%j===4)&&(d=h[d>>>24]<<24^h[d>>16&255]<<16^h[d>>8&255]<<8^h[255&d],b%j===0&&(d=d<<8^d>>>24^k<<24,k=k<<1^283*(k>>7))),e[b]=e[b-j]^d;for(c=0;b;c++,b--)d=e[3&c?b:b-4],g[c]=4>=b||4>c?d:i[0][h[d>>>24]]^i[1][h[d>>16&255]]^i[2][h[d>>8&255]]^i[3][h[255&d]]},f.cipher.aes.prototype={encrypt:function(a){return this._crypt(a,0)},decrypt:function(a){return this._crypt(a,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var a,b,c,d,e,f,g,h,i,j=this._tables[0],k=this._tables[1],l=j[4],m=k[4],n=[],o=[];for(a=0;256>a;a++)o[(n[a]=a<<1^283*(a>>7))^a]=a;for(b=c=0;!l[b];b^=d||1,c=o[c]||1)for(g=c^c<<1^c<<2^c<<3^c<<4,g=g>>8^255&g^99,l[b]=g,m[g]=b,f=n[e=n[d=n[b]]],i=16843009*f^65537*e^257*d^16843008*b,h=257*n[g]^16843008*g,a=0;4>a;a++)j[a][b]=h=h<<24^h>>>8,k[a][g]=i=i<<24^i>>>8;for(a=0;5>a;a++)j[a]=j[a].slice(0),k[a]=k[a].slice(0)},_crypt:function(a,b){if(4!==a.length)throw new f.exception.invalid("invalid aes block size");var c,d,e,g,h=this._key[b],i=a[0]^h[0],j=a[b?3:1]^h[1],k=a[2]^h[2],l=a[b?1:3]^h[3],m=h.length/4-2,n=4,o=[0,0,0,0],p=this._tables[b],q=p[0],r=p[1],s=p[2],t=p[3],u=p[4];for(g=0;m>g;g++)c=q[i>>>24]^r[j>>16&255]^s[k>>8&255]^t[255&l]^h[n],d=q[j>>>24]^r[k>>16&255]^s[l>>8&255]^t[255&i]^h[n+1],e=q[k>>>24]^r[l>>16&255]^s[i>>8&255]^t[255&j]^h[n+2],l=q[l>>>24]^r[i>>16&255]^s[j>>8&255]^t[255&k]^h[n+3],n+=4,i=c,j=d,k=e;for(g=0;4>g;g++)o[b?3&-g:g]=u[i>>>24]<<24^u[j>>16&255]<<16^u[k>>8&255]<<8^u[255&l]^h[n++],c=i,i=j,j=k,k=l,l=c;return o}},f.bitArray={bitSlice:function(a,c,d){return a=f.bitArray._shiftRight(a.slice(c/32),32-(31&c)).slice(1),d===b?a:f.bitArray.clamp(a,d-c)},extract:function(a,b,c){var d,e=Math.floor(-b-c&31);return d=-32&(b+c-1^b)?a[b/32|0]<<32-e^a[b/32+1|0]>>>e:a[b/32|0]>>>e,d&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=f.bitArray.getPartial(c);return 32===d?a.concat(b):f.bitArray._shiftRight(b,d,0|c,a.slice(0,a.length-1))},bitLength:function(a){var b,c=a.length;return 0===c?0:(b=a[c-1],32*(c-1)+f.bitArray.getPartial(b))},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;return b=31&b,c>0&&b&&(a[c-1]=f.bitArray.partial(b,a[c-1]&2147483648>>b-1,1)),a},partial:function(a,b,c){return 32===a?b:(c?0|b:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(f.bitArray.bitLength(a)!==f.bitArray.bitLength(b))return!1;var c,d=0;for(c=0;c<a.length;c++)d|=a[c]^b[c];return 0===d},_shiftRight:function(a,c,d,e){var g,h,i=0;for(e===b&&(e=[]);c>=32;c-=32)e.push(d),d=0;if(0===c)return e.concat(a);for(g=0;g<a.length;g++)e.push(d|a[g]>>>c),d=a[g]<<32-c;return i=a.length?a[a.length-1]:0,h=f.bitArray.getPartial(i),e.push(f.bitArray.partial(c+h&31,c+h>32?d:e.pop(),1)),e},_xor4:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}},f.codec.utf8String={fromBits:function(a){var b,c,d="",e=f.bitArray.bitLength(a);for(b=0;e/8>b;b++)0===(3&b)&&(c=a[b/4]),d+=String.fromCharCode(c>>>24),c<<=8;return decodeURIComponent(escape(d))},toBits:function(a){a=unescape(encodeURIComponent(a));var b,c=[],d=0;for(b=0;b<a.length;b++)d=d<<8|a.charCodeAt(b),3===(3&b)&&(c.push(d),d=0);return 3&b&&c.push(f.bitArray.partial(8*(3&b),d)),c}},f.codec.hex={fromBits:function(a){var b,c="";for(b=0;b<a.length;b++)c+=((0|a[b])+0xf00000000000).toString(16).substr(4);return c.substr(0,f.bitArray.bitLength(a)/4)},toBits:function(a){var b,c,d=[];for(a=a.replace(/\s|0x/g,""),c=a.length,a+="00000000",b=0;b<a.length;b+=8)d.push(0^parseInt(a.substr(b,8),16));return f.bitArray.clamp(d,4*c)}},f.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d,e="",g=0,h=f.codec.base64._chars,i=0,j=f.bitArray.bitLength(a);for(c&&(h=h.substr(0,62)+"-_"),d=0;6*e.length<j;)e+=h.charAt((i^a[d]>>>g)>>>26),6>g?(i=a[d]<<6-g,g+=26,d++):(i<<=6,g-=6);for(;3&e.length&&!b;)e+="=";return e},toBits:function(a,b){a=a.replace(/\s|=/g,"");var c,d,e=[],g=0,h=f.codec.base64._chars,i=0;for(b&&(h=h.substr(0,62)+"-_"),c=0;c<a.length;c++){if(d=h.indexOf(a.charAt(c)),0>d)throw new f.exception.invalid("this isn't base64!");g>26?(g-=26,e.push(i^d>>>g),i=d<<32-g):(g+=6,i^=d<<32-g)}return 56&g&&e.push(f.bitArray.partial(56&g,i,1)),e}},f.codec.base64url={fromBits:function(a){return f.codec.base64.fromBits(a,1,1)},toBits:function(a){return f.codec.base64.toBits(a,1)}},f.hash.sha256=function(a){this._key[0]||this._precompute(),a?(this._h=a._h.slice(0),this._buffer=a._buffer.slice(0),this._length=a._length):this.reset()},f.hash.sha256.hash=function(a){return(new f.hash.sha256).update(a).finalize()},f.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(a){"string"==typeof a&&(a=f.codec.utf8String.toBits(a));var b,c=this._buffer=f.bitArray.concat(this._buffer,a),d=this._length,e=this._length=d+f.bitArray.bitLength(a);for(b=512+d&-512;e>=b;b+=512)this._block(c.splice(0,16));return this},finalize:function(){var a,b=this._buffer,c=this._h;for(b=f.bitArray.concat(b,[f.bitArray.partial(1,1)]),a=b.length+2;15&a;a++)b.push(0);for(b.push(Math.floor(this._length/4294967296)),b.push(0|this._length);b.length;)this._block(b.splice(0,16));return this.reset(),c},_init:[],_key:[],_precompute:function(){function a(a){return 4294967296*(a-Math.floor(a))|0}var b,c=0,d=2;a:for(;64>c;d++){for(b=2;d>=b*b;b++)if(d%b===0)continue a;8>c&&(this._init[c]=a(Math.pow(d,.5))),this._key[c]=a(Math.pow(d,1/3)),c++}},_block:function(a){var b,c,d,e,f=a.slice(0),g=this._h,h=this._key,i=g[0],j=g[1],k=g[2],l=g[3],m=g[4],n=g[5],o=g[6],p=g[7];for(b=0;64>b;b++)16>b?c=f[b]:(d=f[b+1&15],e=f[b+14&15],c=f[15&b]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+f[15&b]+f[b+9&15]|0),c=c+p+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(o^m&(n^o))+h[b],p=o,o=n,n=m,m=l+c|0,l=k,k=j,j=i,i=c+(j&k^l&(j^k))+(j>>>2^j>>>13^j>>>22^j<<30^j<<19^j<<10)|0;g[0]=g[0]+i|0,g[1]=g[1]+j|0,g[2]=g[2]+k|0,g[3]=g[3]+l|0,g[4]=g[4]+m|0,g[5]=g[5]+n|0,g[6]=g[6]+o|0,g[7]=g[7]+p|0}},f.mode.ccm={name:"ccm",encrypt:function(a,b,c,d,e){var g,h,i=b.slice(0),j=f.bitArray,k=j.bitLength(c)/8,l=j.bitLength(i)/8;if(e=e||64,d=d||[],7>k)throw new f.exception.invalid("ccm: iv must be at least 7 bytes");for(g=2;4>g&&l>>>8*g;g++);return 15-k>g&&(g=15-k),c=j.clamp(c,8*(15-g)),h=f.mode.ccm._computeTag(a,b,c,d,e,g),i=f.mode.ccm._ctrMode(a,i,c,h,e,g),j.concat(i.data,i.tag)},decrypt:function(a,b,c,d,e){e=e||64,d=d||[];var g,h,i=f.bitArray,j=i.bitLength(c)/8,k=i.bitLength(b),l=i.clamp(b,k-e),m=i.bitSlice(b,k-e);if(k=(k-e)/8,7>j)throw new f.exception.invalid("ccm: iv must be at least 7 bytes");for(g=2;4>g&&k>>>8*g;g++);if(15-j>g&&(g=15-j),c=i.clamp(c,8*(15-g)),l=f.mode.ccm._ctrMode(a,l,c,m,e,g),h=f.mode.ccm._computeTag(a,l.data,c,d,e,g),!i.equal(l.tag,h))throw new f.exception.corrupt("ccm: tag doesn't match");return l.data},_computeTag:function(a,b,c,d,e,g){var h,i,j,k=[],l=f.bitArray,m=l._xor4;if(e/=8,e%2||4>e||e>16)throw new f.exception.invalid("ccm: invalid tag length");if(d.length>4294967295||b.length>4294967295)throw new f.exception.bug("ccm: can't deal with 4GiB or more data");if(h=[l.partial(8,(d.length?64:0)|e-2<<2|g-1)],h=l.concat(h,c),h[3]|=l.bitLength(b)/8,h=a.encrypt(h),d.length)for(i=l.bitLength(d)/8,65279>=i?k=[l.partial(16,i)]:4294967295>=i&&(k=l.concat([l.partial(16,65534)],[i])),k=l.concat(k,d),j=0;j<k.length;j+=4)h=a.encrypt(m(h,k.slice(j,j+4).concat([0,0,0])));for(j=0;j<b.length;j+=4)h=a.encrypt(m(h,b.slice(j,j+4).concat([0,0,0])));return l.clamp(h,8*e)},_ctrMode:function(a,b,c,d,e,g){var h,i,j,k=f.bitArray,l=k._xor4,m=b.length,n=k.bitLength(b);if(j=k.concat([k.partial(8,g-1)],c).concat([0,0,0]).slice(0,4),d=k.bitSlice(l(d,a.encrypt(j)),0,e),!m)return{tag:d,data:[]};for(i=0;m>i;i+=4)j[3]++,h=a.encrypt(j),b[i]^=h[0],b[i+1]^=h[1],b[i+2]^=h[2],b[i+3]^=h[3];return{tag:d,data:k.clamp(b,n)}}},f.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,g){if(128!==f.bitArray.bitLength(c))throw new f.exception.invalid("ocb iv must be 128 bits");var h,i,j,k,l=f.mode.ocb2._times2,m=f.bitArray,n=m._xor4,o=[0,0,0,0],p=l(a.encrypt(c)),q=[];for(d=d||[],e=e||64,h=0;h+4<b.length;h+=4)i=b.slice(h,h+4),o=n(o,i),q=q.concat(n(p,a.encrypt(n(p,i)))),p=l(p);return i=b.slice(h),j=m.bitLength(i),k=a.encrypt(n(p,[0,0,0,j])),i=m.clamp(n(i.concat([0,0,0]),k),j),o=n(o,n(i.concat([0,0,0]),k)),o=a.encrypt(n(o,n(p,l(p)))),d.length&&(o=n(o,g?d:f.mode.ocb2.pmac(a,d))),q.concat(m.concat(i,m.clamp(o,e)))},decrypt:function(a,b,c,d,e,g){if(128!==f.bitArray.bitLength(c))throw new f.exception.invalid("ocb iv must be 128 bits");e=e||64;var h,i,j,k,l=f.mode.ocb2._times2,m=f.bitArray,n=m._xor4,o=[0,0,0,0],p=l(a.encrypt(c)),q=f.bitArray.bitLength(b)-e,r=[];for(d=d||[],h=0;q/32>h+4;h+=4)i=n(p,a.decrypt(n(p,b.slice(h,h+4)))),o=n(o,i),r=r.concat(i),p=l(p);if(j=q-32*h,k=a.encrypt(n(p,[0,0,0,j])),i=n(k,m.clamp(b.slice(h),j).concat([0,0,0])),o=n(o,i),o=a.encrypt(n(o,n(p,l(p)))),d.length&&(o=n(o,g?d:f.mode.ocb2.pmac(a,d))),!m.equal(m.clamp(o,e),m.bitSlice(b,q)))throw new f.exception.corrupt("ocb: tag doesn't match");return r.concat(m.clamp(i,j))},pmac:function(a,b){var c,d,e=f.mode.ocb2._times2,g=f.bitArray,h=g._xor4,i=[0,0,0,0],j=a.encrypt([0,0,0,0]);for(j=h(j,e(e(j))),c=0;c+4<b.length;c+=4)j=e(j),i=h(i,a.encrypt(h(j,b.slice(c,c+4))));return d=b.slice(c),g.bitLength(d)<128&&(j=h(j,e(j)),d=g.concat(d,[-2147483648,0,0,0])),i=h(i,d),a.encrypt(h(e(h(j,e(j))),i))},_times2:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}},f.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var g,h=b.slice(0),i=f.bitArray;return e=e||128,d=d||[],g=f.mode.gcm._ctrMode(!0,a,h,d,c,e),i.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){var g,h,i=b.slice(0),j=f.bitArray,k=j.bitLength(i);if(e=e||128,d=d||[],k>=e?(h=j.bitSlice(i,k-e),i=j.bitSlice(i,0,k-e)):(h=i,i=[]),g=f.mode.gcm._ctrMode(!1,a,i,d,c,e),!j.equal(g.tag,h))throw new f.exception.corrupt("gcm: tag doesn't match");return g.data},_galoisMultiply:function(a,b){var c,d,e,g,h,i,j=f.bitArray,k=j._xor4;for(g=[0,0,0,0],h=b.slice(0),c=0;128>c;c++){for(e=0!==(a[Math.floor(c/32)]&1<<31-c%32),e&&(g=k(g,h)),i=0!==(1&h[3]),d=3;d>0;d--)h[d]=h[d]>>>1|(1&h[d-1])<<31;h[0]=h[0]>>>1,i&&(h[0]=h[0]^225<<24)}return g},_ghash:function(a,b,c){var d,e,g=c.length;for(d=b.slice(0),e=0;g>e;e+=4)d[0]^=4294967295&c[e],d[1]^=4294967295&c[e+1],d[2]^=4294967295&c[e+2],d[3]^=4294967295&c[e+3],d=f.mode.gcm._galoisMultiply(d,a);return d},_ctrMode:function(a,b,c,d,e,g){{var h,i,j,k,l,m,n,o,p,q,r,s,t=f.bitArray;t._xor4}for(p=c.length,q=t.bitLength(c),r=t.bitLength(d),s=t.bitLength(e),h=b.encrypt([0,0,0,0]),96===s?(i=e.slice(0),i=t.concat(i,[1])):(i=f.mode.gcm._ghash(h,[0,0,0,0],e),i=f.mode.gcm._ghash(h,i,[0,0,Math.floor(s/4294967296),4294967295&s])),j=f.mode.gcm._ghash(h,[0,0,0,0],d),m=i.slice(0),n=j.slice(0),a||(n=f.mode.gcm._ghash(h,j,c)),l=0;p>l;l+=4)m[3]++,k=b.encrypt(m),c[l]^=k[0],c[l+1]^=k[1],c[l+2]^=k[2],c[l+3]^=k[3];return c=t.clamp(c,q),a&&(n=f.mode.gcm._ghash(h,j,c)),o=[Math.floor(r/4294967296),4294967295&r,Math.floor(q/4294967296),4294967295&q],n=f.mode.gcm._ghash(h,n,o),k=b.encrypt(i),n[0]^=k[0],n[1]^=k[1],n[2]^=k[2],n[3]^=k[3],{tag:t.bitSlice(n,0,g),data:c}}},f.misc.hmac=function(a,b){this._hash=b=b||f.hash.sha256;var c,d=[[],[]],e=b.prototype.blockSize/32;for(this._baseHash=[new b,new b],a.length>e&&(a=b.hash(a)),c=0;e>c;c++)d[0][c]=909522486^a[c],d[1][c]=1549556828^a[c];this._baseHash[0].update(d[0]),this._baseHash[1].update(d[1]),this._resultHash=new b(this._baseHash[0])},f.misc.hmac.prototype.encrypt=f.misc.hmac.prototype.mac=function(a){if(this._updated)throw new f.exception.invalid("encrypt on already updated hmac called!");return this.update(a),this.digest(a)},f.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1},f.misc.hmac.prototype.update=function(a){this._updated=!0,this._resultHash.update(a)},f.misc.hmac.prototype.digest=function(){var a=this._resultHash.finalize(),b=new this._hash(this._baseHash[1]).update(a).finalize();return this.reset(),b},f.misc.pbkdf2=function(a,b,c,d,e){if(c=c||1e3,0>d||0>c)throw f.exception.invalid("invalid params to pbkdf2");"string"==typeof a&&(a=f.codec.utf8String.toBits(a)),"string"==typeof b&&(b=f.codec.utf8String.toBits(b)),e=e||f.misc.hmac;var g,h,i,j,k,l=new e(a),m=[],n=f.bitArray;for(k=1;32*m.length<(d||1);k++){for(g=h=l.encrypt(n.concat(b,[k])),i=1;c>i;i++)for(h=l.encrypt(h),j=0;j<h.length;j++)g[j]^=h[j];m=m.concat(g)}return d&&(m=n.clamp(m,d)),m},f.prng=function(a){this._pools=[new f.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=b,this._defaultParanoia=a,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80},f.prng.prototype={randomWords:function(a,b){var c,d,e=[],g=this.isReady(b);if(g===this._NOT_READY)throw new f.exception.notReady("generator isn't seeded");for(g&this._REQUIRES_RESEED&&this._reseedFromPools(!(g&this._READY)),c=0;a>c;c+=4)(c+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),d=this._gen4words(),e.push(d[0],d[1],d[2],d[3]);return this._gate(),e.slice(0,a)},setDefaultParanoia:function(a,b){if(0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b)throw"Setting paranoia=0 will ruin your security; use it only for testing";this._defaultParanoia=a},addEntropy:function(a,c,d){d=d||"user";var e,g,h,i,j=(new Date).valueOf(),k=this._robins[d],l=this.isReady(),m=0;switch(e=this._collectorIds[d],e===b&&(e=this._collectorIds[d]=this._collectorIdNext++),k===b&&(k=this._robins[d]=0),this._robins[d]=(this._robins[d]+1)%this._pools.length,typeof a){case"number":c===b&&(c=1),this._pools[k].update([e,this._eventId++,1,c,j,1,0|a]);break;case"object":if(i=Object.prototype.toString.call(a),"[object Uint32Array]"===i){for(h=[],g=0;g<a.length;g++)h.push(a[g]);a=h}else for("number"!=typeof a.length&&(m=1),g=0;g<a.length&&!m;g++)"number"!=typeof a[g]&&(m=1);if(!m){if(c===b)for(c=0,g=0;g<a.length;g++)for(h=a[g];h>0;)c++,h>>>=1;this._pools[k].update([e,this._eventId++,2,c,j,a.length].concat(a))}break;case"string":c===b&&(c=a.length),this._pools[k].update([e,this._eventId++,3,c,j,a.length]),this._pools[k].update(a);break;default:m=1}if(m)throw new f.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[k]+=c,this._poolStrength+=c,l===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(a){var c=this._PARANOIA_LEVELS[a!==b?a:this._defaultParanoia];return this._strength&&this._strength>=c?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=c?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(a){var b=this._PARANOIA_LEVELS[a?a:this._defaultParanoia];return this._strength>=b?1:this._poolStrength>b?1:this._poolStrength/b},startCollectors:function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector)},a.addEventListener)a.addEventListener("load",this._eventListener.loadTimeCollector,!1),a.addEventListener("mousemove",this._eventListener.mouseCollector,!1),a.addEventListener("keypress",this._eventListener.keyboardCollector,!1),a.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1);else{if(!document.attachEvent)throw new f.exception.bug("can't attach event");document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(a.removeEventListener?(a.removeEventListener("load",this._eventListener.loadTimeCollector,!1),a.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),a.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),a.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(a,b){this._callbacks[a][this._callbackI++]=b},removeEventListener:function(a,b){var c,d,e=this._callbacks[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},_bind:function(a){var b=this;return function(){a.apply(b,arguments)}},_gen4words:function(){for(var a=0;4>a&&(this._counter[a]=this._counter[a]+1|0,!this._counter[a]);a++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new f.cipher.aes(this._key)},_reseed:function(a){this._key=f.hash.sha256.hash(this._key.concat(a)),this._cipher=new f.cipher.aes(this._key);for(var b=0;4>b&&(this._counter[b]=this._counter[b]+1|0,!this._counter[b]);b++);},_reseedFromPools:function(a){var b,c=[],d=0;for(this._nextReseed=c[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,b=0;16>b;b++)c.push(4294967296*Math.random()|0);for(b=0;b<this._pools.length&&(c=c.concat(this._pools[b].finalize()),d+=this._poolEntropy[b],this._poolEntropy[b]=0,a||!(this._reseedCount&1<<b));b++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new f.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=d,d>this._strength&&(this._strength=d),this._reseedCount++,this._reseed(c)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(a){var b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0;f.random.addEntropy([b,c],2,"mouse"),this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(b){a&&a.performance&&"function"==typeof a.performance.now?f.random.addEntropy(a.performance.now(),b,"loadtime"):f.random.addEntropy((new Date).valueOf(),b,"loadtime")},_accelerometerCollector:function(b){var c=b.accelerationIncludingGravity.x||b.accelerationIncludingGravity.y||b.accelerationIncludingGravity.z,d="";a.orientation&&(d=a.orientation),f.random.addEntropy([c,d],3,"accelerometer"),this._addCurrentTimeToEntropy(0)},_fireEvent:function(a,b){var c,d=f.random._callbacks[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}},f.random=new f.prng(6),function(){try{var b,c,d;if("undefined"!=typeof module&&module.exports&&(c=require("crypto"))&&c.randomBytes)b=c.randomBytes(128),f.random.addEntropy(b.slice(),1024,"crypto.randomBytes");else if(a&&Uint32Array){if(d=new Uint32Array(32),a.crypto&&a.crypto.getRandomValues)a.crypto.getRandomValues(d);else{if(!a.msCrypto||!a.msCrypto.getRandomValues)return;a.msCrypto.getRandomValues(d)}f.random.addEntropy(d,1024,"crypto.getRandomValues")}}catch(e){console.log("There was an error collecting entropy from the browser:"),console.log(e)}}(),f.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},_encrypt:function(a,b,c,d){c=c||{},d=d||{};var e,g,h,i=f.json,j=i._add({iv:f.random.randomWords(4,0)},i.defaults);if(i._add(j,c),h=j.adata,"string"==typeof j.salt&&(j.salt=f.codec.base64.toBits(j.salt)),"string"==typeof j.iv&&(j.iv=f.codec.base64.toBits(j.iv)),!f.mode[j.mode]||!f.cipher[j.cipher]||"string"==typeof a&&j.iter<=100||64!==j.ts&&96!==j.ts&&128!==j.ts||128!==j.ks&&192!==j.ks&&256!==j.ks||j.iv.length<2||j.iv.length>4)throw new f.exception.invalid("json encrypt: invalid parameters");return"string"==typeof a?(e=f.misc.cachedPbkdf2(a,j),a=e.key.slice(0,j.ks/32),j.salt=e.salt):f.ecc&&a instanceof f.ecc.elGamal.publicKey&&(e=a.kem(),j.kemtag=e.tag,a=e.key.slice(0,j.ks/32)),"string"==typeof b&&(b=f.codec.utf8String.toBits(b)),"string"==typeof h&&(h=f.codec.utf8String.toBits(h)),g=new f.cipher[j.cipher](a),i._add(d,j),d.key=a,j.ct=f.mode[j.mode].encrypt(g,b,j.iv,h,j.ts),j},encrypt:function(){var a=f.json,b=a._encrypt.apply(a,arguments);return a.encode(b)},_decrypt:function(a,b,c,d){c=c||{},d=d||{};var e,g,h,i=f.json,j=i._add(i._add(i._add({},i.defaults),b),c,!0),k=j.adata;if("string"==typeof j.salt&&(j.salt=f.codec.base64.toBits(j.salt)),"string"==typeof j.iv&&(j.iv=f.codec.base64.toBits(j.iv)),!f.mode[j.mode]||!f.cipher[j.cipher]||"string"==typeof a&&j.iter<=100||64!==j.ts&&96!==j.ts&&128!==j.ts||128!==j.ks&&192!==j.ks&&256!==j.ks||!j.iv||j.iv.length<2||j.iv.length>4)throw new f.exception.invalid("json decrypt: invalid parameters");return"string"==typeof a?(g=f.misc.cachedPbkdf2(a,j),a=g.key.slice(0,j.ks/32),j.salt=g.salt):f.ecc&&a instanceof f.ecc.elGamal.secretKey&&(a=a.unkem(f.codec.base64.toBits(j.kemtag)).slice(0,j.ks/32)),"string"==typeof k&&(k=f.codec.utf8String.toBits(k)),h=new f.cipher[j.cipher](a),e=f.mode[j.mode].decrypt(h,j.ct,j.iv,k,j.ts),i._add(d,j),d.key=a,f.codec.utf8String.fromBits(e)},decrypt:function(a,b,c,d){var e=f.json;return e._decrypt(a,e.decode(b),c,d)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new f.exception.invalid("json encode: invalid property name");switch(c+=d+'"'+b+'":',d=",",typeof a[b]){case"number":case"boolean":c+=a[b];break;case"string":c+='"'+escape(a[b])+'"';break;case"object":c+='"'+f.codec.base64.fromBits(a[b],0)+'"';break;default:throw new f.exception.bug("json encode: unsupported type")}}return c+"}"},decode:function(a){if(a=a.replace(/\s/g,""),!a.match(/^\{.*\}$/))throw new f.exception.invalid("json decode: this isn't json!");var b,c,d=a.replace(/^\{|\}$/g,"").split(/,/),e={};for(b=0;b<d.length;b++){if(!(c=d[b].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new f.exception.invalid("json decode: this isn't json!");e[c[2]]=c[3]?parseInt(c[3],10):c[2].match(/^(ct|salt|iv)$/)?f.codec.base64.toBits(c[4]):unescape(c[4])}return e},_add:function(a,c,d){if(a===b&&(a={}),c===b)return a;var e;for(e in c)if(c.hasOwnProperty(e)){if(d&&a[e]!==b&&a[e]!==c[e])throw new f.exception.invalid("required parameter overridden");a[e]=c[e]}return a},_subtract:function(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&a[c]!==b[c]&&(d[c]=a[c]);return d},_filter:function(a,c){var d,e={};for(d=0;d<c.length;d++)a[c[d]]!==b&&(e[c[d]]=a[c[d]]);return e}},f.encrypt=f.json.encrypt,f.decrypt=f.json.decrypt,f.misc._pbkdf2Cache={},f.misc.cachedPbkdf2=function(a,c){var d,e,g,h,i=f.misc._pbkdf2Cache;return c=c||{},h=c.iter||1e3,e=i[a]=i[a]||{},d=e[h]=e[h]||{firstSalt:c.salt&&c.salt.length?c.salt.slice(0):f.random.randomWords(2,0)},g=c.salt===b?d.firstSalt:c.salt,d[g]=d[g]||f.misc.pbkdf2(a,g,c.iter),{key:d[g].slice(0),salt:g.slice(0)}},f.bn=function(a){this.initWith(a)},f.bn.prototype={radix:24,maxMul:8,_class:f.bn,copy:function(){return new this._class(this)},initWith:function(a){var b,c=0;switch(typeof a){case"object":this.limbs=a.limbs.slice(0);break;case"number":this.limbs=[a],this.normalize();break;case"string":for(a=a.replace(/^0x/,""),this.limbs=[],b=this.radix/4,c=0;c<a.length;c+=b)this.limbs.push(parseInt(a.substring(Math.max(a.length-c-b,0),a.length-c),16));break;default:this.limbs=[0]}return this},equals:function(a){"number"==typeof a&&(a=new this._class(a));var b,c=0;for(this.fullReduce(),a.fullReduce(),b=0;b<this.limbs.length||b<a.limbs.length;b++)c|=this.getLimb(b)^a.getLimb(b);return 0===c},getLimb:function(a){return a>=this.limbs.length?0:this.limbs[a]},greaterEquals:function(a){"number"==typeof a&&(a=new this._class(a));var b,c,d,e=0,f=0;for(b=Math.max(this.limbs.length,a.limbs.length)-1;b>=0;b--)c=this.getLimb(b),d=a.getLimb(b),f|=d-c&~e,e|=c-d&~f;return(f|~e)>>>31},toString:function(){this.fullReduce();var a,b,c="",d=this.limbs;for(a=0;a<this.limbs.length;a++){for(b=d[a].toString(16);a<this.limbs.length-1&&b.length<6;)b="0"+b;c=b+c}return"0x"+c},addM:function(a){"object"!=typeof a&&(a=new this._class(a));var b,c=this.limbs,d=a.limbs;for(b=c.length;b<d.length;b++)c[b]=0;for(b=0;b<d.length;b++)c[b]+=d[b];return this},doubleM:function(){var a,b,c=0,d=this.radix,e=this.radixMask,f=this.limbs;for(a=0;a<f.length;a++)b=f[a],b=b+b+c,f[a]=b&e,c=b>>d;return c&&f.push(c),this},halveM:function(){var a,b,c=0,d=this.radix,e=this.limbs;for(a=e.length-1;a>=0;a--)b=e[a],e[a]=b+c>>1,c=(1&b)<<d;return e[e.length-1]||e.pop(),this},subM:function(a){"object"!=typeof a&&(a=new this._class(a));var b,c=this.limbs,d=a.limbs;for(b=c.length;b<d.length;b++)c[b]=0;for(b=0;b<d.length;b++)c[b]-=d[b];return this},mod:function(a){var b=!this.greaterEquals(new f.bn(0));a=new f.bn(a).normalize();var c=new f.bn(this).normalize(),d=0;for(b&&(c=new f.bn(0).subM(c).normalize());c.greaterEquals(a);d++)a.doubleM();for(b&&(c=a.sub(c).normalize());d>0;d--)a.halveM(),c.greaterEquals(a)&&c.subM(a).normalize();return c.trim()},inverseMod:function(a){var b,c,d=new f.bn(1),e=new f.bn(0),g=new f.bn(this),h=new f.bn(a),i=1;if(!(1&a.limbs[0]))throw new f.exception.invalid("inverseMod: p must be odd");do for(1&g.limbs[0]&&(g.greaterEquals(h)||(b=g,g=h,h=b,b=d,d=e,e=b),g.subM(h),g.normalize(),d.greaterEquals(e)||d.addM(a),d.subM(e)),g.halveM(),1&d.limbs[0]&&d.addM(a),d.normalize(),d.halveM(),c=i=0;c<g.limbs.length;c++)i|=g.limbs[c];while(i);if(!h.equals(1))throw new f.exception.invalid("inverseMod: p and x must be relatively prime");return e},add:function(a){return this.copy().addM(a)},sub:function(a){return this.copy().subM(a)},mul:function(a){"number"==typeof a&&(a=new this._class(a));var b,c,d,e=this.limbs,f=a.limbs,g=e.length,h=f.length,i=new this._class,j=i.limbs,k=this.maxMul;for(b=0;b<this.limbs.length+a.limbs.length+1;b++)j[b]=0;for(b=0;g>b;b++){for(d=e[b],c=0;h>c;c++)j[b+c]+=d*f[c];--k||(k=this.maxMul,i.cnormalize())}return i.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(a){"number"==typeof a?a=[a]:a.limbs!==b&&(a=a.normalize().limbs);var c,d,e=new this._class(1),f=this;for(c=0;c<a.length;c++)for(d=0;d<this.radix;d++)a[c]&1<<d&&(e=e.mul(f)),f=f.square();return e},mulmod:function(a,b){return this.mod(b).mul(a.mod(b)).mod(b)},powermod:function(a,b){for(var c=new f.bn(1),d=new f.bn(this),e=new f.bn(a);;){if(1&e.limbs[0]&&(c=c.mulmod(d,b)),e.halveM(),e.equals(0))break;d=d.mulmod(d,b)}return c.normalize().reduce()},trim:function(){var a,b=this.limbs;do a=b.pop();while(b.length&&0===a);return b.push(a),this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var a,b,c,d=0,e=(this.placeVal,this.ipv),f=this.limbs,g=f.length,h=this.radixMask;for(a=0;g>a||0!==d&&-1!==d;a++)b=(f[a]||0)+d,c=f[a]=b&h,d=(b-c)*e;return-1===d&&(f[a-1]-=this.placeVal),this},cnormalize:function(){var a,b,c,d=0,e=this.ipv,f=this.limbs,g=f.length,h=this.radixMask;for(a=0;g-1>a;a++)b=f[a]+d,c=f[a]=b&h,d=(b-c)*e;return f[a]+=d,this},toBits:function(a){this.fullReduce(),a=a||this.exponent||this.bitLength();var b=Math.floor((a-1)/24),c=f.bitArray,d=(a+7&-8)%this.radix||this.radix,e=[c.partial(d,this.getLimb(b))];for(b--;b>=0;b--)e=c.concat(e,[c.partial(Math.min(this.radix,a),this.getLimb(b))]),a-=this.radix;return e},bitLength:function(){this.fullReduce();for(var a=this.radix*(this.limbs.length-1),b=this.limbs[this.limbs.length-1];b;b>>>=1)a++;return a+7&-8}},f.bn.fromBits=function(a){var b=this,c=new b,d=[],e=f.bitArray,g=this.prototype,h=Math.min(this.bitLength||4294967296,e.bitLength(a)),i=h%g.radix||g.radix;for(d[0]=e.extract(a,0,i);h>i;i+=g.radix)d.unshift(e.extract(a,i,g.radix));return c.limbs=d,c},f.bn.prototype.ipv=1/(f.bn.prototype.placeVal=Math.pow(2,f.bn.prototype.radix)),f.bn.prototype.radixMask=(1<<f.bn.prototype.radix)-1,f.bn.pseudoMersennePrime=function(a,b){function c(a){this.initWith(a)}var d,e,g,h=c.prototype=new f.bn;for(g=h.modOffset=Math.ceil(e=a/h.radix),h.exponent=a,h.offset=[],h.factor=[],h.minOffset=g,h.fullMask=0,h.fullOffset=[],h.fullFactor=[],h.modulus=c.modulus=new f.bn(Math.pow(2,a)),h.fullMask=0|-Math.pow(2,a%h.radix),d=0;d<b.length;d++)h.offset[d]=Math.floor(b[d][0]/h.radix-e),h.fullOffset[d]=Math.ceil(b[d][0]/h.radix-e),h.factor[d]=b[d][1]*Math.pow(.5,a-b[d][0]+h.offset[d]*h.radix),h.fullFactor[d]=b[d][1]*Math.pow(.5,a-b[d][0]+h.fullOffset[d]*h.radix),h.modulus.addM(new f.bn(Math.pow(2,b[d][0])*b[d][1])),h.minOffset=Math.min(h.minOffset,-h.offset[d]);return h._class=c,h.modulus.cnormalize(),h.reduce=function(){var a,b,c,d,e=this.modOffset,f=this.limbs,g=this.offset,h=this.offset.length,i=this.factor;for(a=this.minOffset;f.length>e;){for(c=f.pop(),d=f.length,b=0;h>b;b++)f[d+g[b]]-=i[b]*c;a--,a||(f.push(0),this.cnormalize(),a=this.minOffset)}return this.cnormalize(),this},h._strongReduce=-1===h.fullMask?h.reduce:function(){var a,b,c=this.limbs,d=c.length-1;if(this.reduce(),d===this.modOffset-1){for(b=c[d]&this.fullMask,c[d]-=b,a=0;a<this.fullOffset.length;a++)c[d+this.fullOffset[a]]-=this.fullFactor[a]*b;this.normalize()}},h.fullReduce=function(){var a,b;for(this._strongReduce(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this._strongReduce(),b=this.limbs.length;b<this.modOffset;b++)this.limbs[b]=0;for(a=this.greaterEquals(this.modulus),b=0;b<this.limbs.length;b++)this.limbs[b]-=this.modulus.limbs[b]*a;return this.cnormalize(),this},h.inverse=function(){return this.power(this.modulus.sub(2))},c.fromBits=f.bn.fromBits,c};var g=f.bn.pseudoMersennePrime;f.bn.prime={p127:g(127,[[0,-1]]),p25519:g(255,[[0,-19]]),p192k:g(192,[[32,-1],[12,-1],[8,-1],[7,-1],[6,-1],[3,-1],[0,-1]]),p224k:g(224,[[32,-1],[12,-1],[11,-1],[9,-1],[7,-1],[4,-1],[1,-1],[0,-1]]),p256k:g(256,[[32,-1],[9,-1],[8,-1],[7,-1],[6,-1],[4,-1],[0,-1]]),p192:g(192,[[0,-1],[64,-1]]),p224:g(224,[[0,1],[96,-1]]),p256:g(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:g(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:g(521,[[0,-1]])},f.bn.random=function(a,b){"object"!=typeof a&&(a=new f.bn(a));for(var c,d,e=a.limbs.length,g=a.limbs[e-1]+1,h=new f.bn;;){do c=f.random.randomWords(e,b),c[e-1]<0&&(c[e-1]+=4294967296);while(Math.floor(c[e-1]/g)===Math.floor(4294967296/g));for(c[e-1]%=g,d=0;e-1>d;d++)c[d]&=a.radixMask;
if(h.limbs=c,!h.greaterEquals(a))return h}},f.ecc={},f.ecc.point=function(a,c,d){c===b?this.isIdentity=!0:(this.x=c,this.y=d,this.isIdentity=!1),this.curve=a},f.ecc.point.prototype={toJac:function(){return new f.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},mult:function(a){return this.toJac().mult(a,this).toAffine()},mult2:function(a,b,c){return this.toJac().mult2(a,this,b,c).toAffine()},multiples:function(){var a,c,d;if(this._multiples===b)for(d=this.toJac().doubl(),a=this._multiples=[new f.ecc.point(this.curve),this,d.toAffine()],c=3;16>c;c++)d=d.add(this),a.push(d.toAffine());return this._multiples},isValid:function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},toBits:function(){return f.bitArray.concat(this.x.toBits(),this.y.toBits())}},f.ecc.pointJac=function(a,c,d,e){c===b?this.isIdentity=!0:(this.x=c,this.y=d,this.z=e,this.isIdentity=!1),this.curve=a},f.ecc.pointJac.prototype={add:function(a){var b,c,d,e,g,h,i,j,k,l,m,n=this;if(n.curve!==a.curve)throw"sjcl.ecc.add(): Points must be on the same curve to add them!";return n.isIdentity?a.toJac():a.isIdentity?n:(b=n.z.square(),c=a.x.mul(b).subM(n.x),c.equals(0)?n.y.equals(a.y.mul(b.mul(n.z)))?n.doubl():new f.ecc.pointJac(n.curve):(d=a.y.mul(b.mul(n.z)).subM(n.y),e=c.square(),g=d.square(),h=c.square().mul(c).addM(n.x.add(n.x).mul(e)),i=g.subM(h),j=n.x.mul(e).subM(i).mul(d),k=n.y.mul(c.square().mul(c)),l=j.subM(k),m=n.z.mul(c),new f.ecc.pointJac(this.curve,i,l,m)))},doubl:function(){if(this.isIdentity)return this;var a=this.y.square(),b=a.mul(this.x.mul(4)),c=a.square().mul(8),d=this.z.square(),e=this.curve.a.toString()==new f.bn(-3).toString()?this.x.sub(d).mul(3).mul(this.x.add(d)):this.x.square().mul(3).add(d.square().mul(this.curve.a)),g=e.square().subM(b).subM(b),h=b.sub(g).mul(e).subM(c),i=this.y.add(this.y).mul(this.z);return new f.ecc.pointJac(this.curve,g,h,i)},toAffine:function(){if(this.isIdentity||this.z.equals(0))return new f.ecc.point(this.curve);var a=this.z.inverse(),b=a.square();return new f.ecc.point(this.curve,this.x.mul(b).fullReduce(),this.y.mul(b.mul(a)).fullReduce())},mult:function(a,c){"number"==typeof a?a=[a]:a.limbs!==b&&(a=a.normalize().limbs);var d,e,g=new f.ecc.point(this.curve).toJac(),h=c.multiples();for(d=a.length-1;d>=0;d--)for(e=f.bn.prototype.radix-4;e>=0;e-=4)g=g.doubl().doubl().doubl().doubl().add(h[a[d]>>e&15]);return g},mult2:function(a,c,d,e){"number"==typeof a?a=[a]:a.limbs!==b&&(a=a.normalize().limbs),"number"==typeof d?d=[d]:d.limbs!==b&&(d=d.normalize().limbs);var g,h,i,j,k=new f.ecc.point(this.curve).toJac(),l=c.multiples(),m=e.multiples();for(g=Math.max(a.length,d.length)-1;g>=0;g--)for(i=0|a[g],j=0|d[g],h=f.bn.prototype.radix-4;h>=0;h-=4)k=k.doubl().doubl().doubl().doubl().add(l[i>>h&15]).add(m[j>>h&15]);return k},isValid:function(){var a=this.z.square(),b=a.square(),c=b.mul(a);return this.y.square().equals(this.curve.b.mul(c).add(this.x.mul(this.curve.a.mul(b).add(this.x.square()))))}},f.ecc.curve=function(a,b,c,d,e,g){this.field=a,this.r=new f.bn(b),this.a=new a(c),this.b=new a(d),this.G=new f.ecc.point(this,new a(e),new a(g))},f.ecc.curve.prototype.fromBits=function(a){var b=f.bitArray,c=this.field.prototype.exponent+7&-8,d=new f.ecc.point(this,this.field.fromBits(b.bitSlice(a,0,c)),this.field.fromBits(b.bitSlice(a,c,2*c)));if(!d.isValid())throw new f.exception.corrupt("not on the curve!");return d},f.ecc.curves={c192:new f.ecc.curve(f.bn.prime.p192,"0xffffffffffffffffffffffff99def836146bc9b1b4d22831",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new f.ecc.curve(f.bn.prime.p224,"0xffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new f.ecc.curve(f.bn.prime.p256,"0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new f.ecc.curve(f.bn.prime.p384,"0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),k192:new f.ecc.curve(f.bn.prime.p192k,"0xfffffffffffffffffffffffe26f2fc170f69466a74defd8d",0,3,"0xdb4ff10ec057e9ae26b07d0280b7f4341da5d1b1eae06c7d","0x9b2f2f6d9c5628a7844163d015be86344082aa88d95e2f9d"),k224:new f.ecc.curve(f.bn.prime.p224k,"0x010000000000000000000000000001dce8d2ec6184caf0a971769fb1f7",0,5,"0xa1455b334df099df30fc28a169a467e9e47075a90f7e650eb6b7a45c","0x7e089fed7fba344282cafbd6f7e319f7c0b0bd59e2ca4bdb556d61a5"),k256:new f.ecc.curve(f.bn.prime.p256k,"0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141",0,7,"0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},f.ecc.basicKey={publicKey:function(a,b){this._curve=a,this._curveBitLength=a.r.bitLength(),this._point=b instanceof Array?a.fromBits(b):b,this.get=function(){var a=this._point.toBits(),b=f.bitArray.bitLength(a),c=f.bitArray.bitSlice(a,0,b/2),d=f.bitArray.bitSlice(a,b/2);return{x:c,y:d}}},secretKey:function(a,b){this._curve=a,this._curveBitLength=a.r.bitLength(),this._exponent=b,this.get=function(){return this._exponent.toBits()}}},f.ecc.basicKey.generateKeys=function(a){return function(c,d,e){if(c=c||256,d=d||0,"number"==typeof c&&(c=f.ecc.curves["c"+c],c===b))throw new f.exception.invalid("no such curve");e=e||f.bn.random(c.r,d);var g=c.G.mult(e);return{pub:new f.ecc[a].publicKey(c,g),sec:new f.ecc[a].secretKey(c,e)}}},f.ecc.elGamal={generateKeys:f.ecc.basicKey.generateKeys("elGamal"),publicKey:function(){f.ecc.basicKey.publicKey.apply(this,arguments)},secretKey:function(){f.ecc.basicKey.secretKey.apply(this,arguments)}},f.ecc.elGamal.publicKey.prototype={kem:function(a){var b=f.bn.random(this._curve.r,a),c=this._curve.G.mult(b).toBits(),d=f.hash.sha256.hash(this._point.mult(b).toBits());return{key:d,tag:c}}},f.ecc.elGamal.secretKey.prototype={unkem:function(a){return f.hash.sha256.hash(this._curve.fromBits(a).mult(this._exponent).toBits())},dh:function(a){return f.hash.sha256.hash(a._point.mult(this._exponent).toBits())}},f.ecc.ecdsa={generateKeys:f.ecc.basicKey.generateKeys("ecdsa")},f.ecc.ecdsa.publicKey=function(){f.ecc.basicKey.publicKey.apply(this,arguments)},f.ecc.ecdsa.publicKey.prototype={verify:function(a,c,d){f.bitArray.bitLength(a)>this._curveBitLength&&(a=f.bitArray.clamp(a,this._curveBitLength));var e=f.bitArray,g=this._curve.r,h=this._curveBitLength,i=f.bn.fromBits(e.bitSlice(c,0,h)),j=f.bn.fromBits(e.bitSlice(c,h,2*h)),k=d?j:j.inverseMod(g),l=f.bn.fromBits(a).mul(k).mod(g),m=i.mul(k).mod(g),n=this._curve.G.mult2(l,m,this._point).x;if(i.equals(0)||j.equals(0)||i.greaterEquals(g)||j.greaterEquals(g)||!n.equals(i)){if(d===b)return this.verify(a,c,!0);throw new f.exception.corrupt("signature didn't check out")}return!0}},f.ecc.ecdsa.secretKey=function(){f.ecc.basicKey.secretKey.apply(this,arguments)},f.ecc.ecdsa.secretKey.prototype={sign:function(a,b,c,d){f.bitArray.bitLength(a)>this._curveBitLength&&(a=f.bitArray.clamp(a,this._curveBitLength));var e=this._curve.r,g=e.bitLength(),h=d||f.bn.random(e.sub(1),b).add(1),i=this._curve.G.mult(h).x.mod(e),j=f.bn.fromBits(a).add(i.mul(this._exponent)),k=c?j.inverseMod(e).mul(h).mod(e):j.mul(h.inverseMod(e)).mod(e);return f.bitArray.concat(i.toBits(g),k.toBits(g))}};var h={curve:384,generate:!1,signVerify:!0,encryptDecrypt:!0,encryptKey:null,decryptKey:null,verifyKey:null,signKey:null},i=function(){return new e};i.sjcl=f;var j={elg:c("elGamal"),dsa:c("ecdsa"),exportPublic:function(a){var b=a.get();return f.codec.hex.fromBits(b.x)+f.codec.hex.fromBits(b.y)},exportSecret:function(a){return f.codec.hex.fromBits(a.get())},sha256:d("sha256")};e.prototype.curve=h.curve,e.prototype.keys=function(a){for(var b in h)a.hasOwnProperty(b)||(a[b]=h[b]);if(this.curve=a.curve,a.generate&&a.encryptDecrypt){if(a.encryptKey||a.decryptKey)throw new Error("Keys 'encryptKey' and 'decryptKey' will be overridden");var c=j.elg.generate(this.curve);this.k.encrypt=c.pub,this.k.decrypt=c.sec}if(a.generate&&a.signVerify){if(a.signKey||a.verifyKey)throw new Error("Keys 'signKey' and 'verifyKey' will be overridden");var d=j.dsa.generate(this.curve);this.k.verify=d.pub,this.k.sign=d.sec}return a.encryptKey&&(this.k.encrypt=j.elg.importPublicHex(this.curve,a.encryptKey)),a.decryptKey&&(this.k.decrypt=j.elg.importSecretHex(this.curve,a.decryptKey)),a.verifyKey&&(this.k.verify=j.dsa.importPublicHex(this.curve,a.verifyKey)),a.signKey&&(this.k.sign=j.dsa.importSecretHex(this.curve,a.signKey)),this.k.encrypt&&(this.encryptKey=j.exportPublic(this.k.encrypt)),this.k.verify&&(this.verifyKey=j.exportPublic(this.k.verify)),this},e.prototype.addEncryptKey=function(a,b){if(this.enck[a])throw new Error("Encryption key already exists beloning to: "+a);var c=j.elg.importPublicHex(this.curve,b);this.enck[a]=c.kem()},e.prototype.encrypt=function(a,b){var c=this.enck[a];if(!c)throw new Error("Could not find encrytion key beloning to: "+a);c.tagHex||(c.tagHex=f.codec.hex.fromBits(c.tag));var d=f.json._encrypt(c.key,b);return d.tag=c.tagHex,JSON.stringify(d)},e.prototype.decrypt=function(a){if(!this.k.decrypt)throw new Error("Decryption key missing");var b=JSON.parse(a),c=this.deck[b.tag];return c||(c=this.deck[b.tag]=this.k.decrypt.unkem(f.codec.hex.toBits(b.tag))),f.json._decrypt(c,b)},e.prototype.sign=function(a,b){if(!this.k.sign)throw new Error("Sign key missing");return b&&(a=j[b].hash(a)),this.k.sign.sign(a)},e.prototype.addVerifyKey=function(a,b){if(this.verk[a])throw new Error("Verify key already exists beloning to: "+a);this.verk[a]=j.dsa.importPublicHex(this.curve,b)},e.prototype.verify=function(a,b,c,d){var e=this.verk[a];if(!e)throw new Error("Could not find verify key beloning to: "+a);d&&(b=j[d].hash(b));try{return e.verify(b,c)}catch(f){return!1}},"undefined"!=typeof module&&module.exports?module.exports=i:a.ecc=i}(this);