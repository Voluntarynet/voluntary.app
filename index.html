<!DOCTYPE html>
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    
    <link rel="stylesheet" href="_css.css">
    <link rel="stylesheet" href="view/_css.css">
    <link rel="stylesheet" href="lib/view/_css.css">
    <link rel="stylesheet" href="lib/view/browser/_css.css">
    <link rel="stylesheet" href="lib/view/browser/_area.css">
    
  </head>
  
		
		<script>
		/**
 * Loads one more external JS files and optionally calls a callback function
 * when done.
 * @param {!Array.<string>} urls
 *     URLs of external JS files to load.
 * @param {function(!Array.<!Object>)|udefined} callback
 *     Optional callback function to execute once all of the scripts have been
 *     loaded.  The parameter passed will be an array of objects containing the
 *     "script", "url", and "event" (event name fired indicating the script
 *     loaded).
 */
var loadSequentialJS = (function(document) {
  return function(urls, callback) {
    var results = [];
    var parent = document.getElementsByTagName('head')[0] || document.body;
    var urlsLeft = urls.length;
     
    function loadNext(len, script, url, eventName) {
      if (urlsLeft == len) {
        if (eventName) {
          results.push({
            script: script,
            url: url,
            event: eventName
          });
        }
        if (urlsLeft) {
          var url = urls.shift();
          len = --urlsLeft;
          var script = document.createElement('script');
          script.src = url;
          script.onload = function() {
            loadNext(len, script, url, 'load');
          };
          script.onerror = function() {
            loadNext(len, script, url, 'error');
          };
          parent.appendChild(script);
        }
        else if (callback) {
          callback(results);
        }
      }
    }
    loadNext(urlsLeft);
  };
})(document);

		    var files = [
		    
		        "external_libs/bitcore/bower_components/bitcore-lib/bitcore-lib.min.js",
		        "external_libs/bitcore/bower_components/bitcore-mnemonic/bitcore-mnemonic.min.js",


		        "external_libs/json-stable-stringify/json-stable-stringify.js",

		        "external_libs/sjcl-master/core/sjcl.js",
		        "external_libs/sjcl-master/core/aes.js",
		        "external_libs/sjcl-master/core/bitArray.js",
		        "external_libs/sjcl-master/core/bn.js",
		        "external_libs/sjcl-master/core/cbc.js",
		        "external_libs/sjcl-master/core/ccm.js",
		        "external_libs/sjcl-master/core/ccmArrayBuffer.js",
		        "external_libs/sjcl-master/core/codecArrayBuffer.js",
		        "external_libs/sjcl-master/core/codecBase32.js",
		        "external_libs/sjcl-master/core/codecBase64.js",
		        "external_libs/sjcl-master/core/codecBytes.js",
		        "external_libs/sjcl-master/core/codecHex.js",
		        "external_libs/sjcl-master/core/codecString.js",
		        "external_libs/sjcl-master/core/codecZ85.js",
		        "external_libs/sjcl-master/core/convenience.js",
		        "external_libs/sjcl-master/core/ctr.js",
		        "external_libs/sjcl-master/core/ecc.js",
		        "external_libs/sjcl-master/core/exports.js",
		        "external_libs/sjcl-master/core/gcm.js",
		        "external_libs/sjcl-master/core/hkdf.js",
		        "external_libs/sjcl-master/core/hmac.js",
		        "external_libs/sjcl-master/core/ocb2.js",
		        "external_libs/sjcl-master/core/ocb2progressive.js",
		        "external_libs/sjcl-master/core/pbkdf2.js",
		        "external_libs/sjcl-master/core/ripemd160.js",
		        "external_libs/sjcl-master/core/scrypt.js",
		        "external_libs/sjcl-master/core/sha1.js",
		        "external_libs/sjcl-master/core/sha256.js",
		        "external_libs/sjcl-master/core/sha512.js",
		        "external_libs/sjcl-master/core/srp.js",
		        "external_libs/sjcl-master/core/random.js",
		        "external_libs/sjcl-extras/codecBits.js",

		        "data/categories.json",
		        "data/us_cities.json",
		        "data/countries.json",
		        "data/currencies.json",


		        "lib/ideal/ideal.js",
		        "lib/ideal/ideal_plus.js",

		        "lib/notification/Notification.js",
		        "lib/notification/NotificationCenter.js",
		        "lib/notification/Observation.js",

		        "lib/peerjs/peer.js",

		        "lib/node/BMNode.js",
		        "lib/node/BMField.js",
		        "lib/node/Nodes/BMStorableNode.js",
		        "lib/node/Nodes/BMFormNode.js",
		        "lib/node/Nodes/BMInfoNode.js",
		        "lib/node/Nodes/BMImageNode.js",
		        "lib/node/Nodes/BMNavNode.js",
		        "lib/node/NodeStore.js",

		        "lib/model/BaseApp.js",
		        

		        "model/network/BMMessages.js",
		        "model/network/BMNetwork.js",
		        "model/network/BMPayload.js",
		        "model/network/BMPow.js",

		        "model/network/webrtc/BMServerConnection.js",
		        "model/network/webrtc/BMRServer.js",
                "model/network/webrtc/BMRServers.js",
                "model/network/webrtc/BMRemotePeer.js",
                
                "model/network/messages/BMMessage.js",
                "model/network/messages/BMAddrMessage.js",
                "model/network/messages/BMGetDataMessage.js",
                "model/network/messages/BMInvMessage.js",
                "model/network/messages/BMObjectMessage.js",
                "model/network/messages/BMPingMessage.js",
                "model/network/messages/BMPongMessage.js",
 
                "lib/view/CSS.js",
                "lib/view/Div.js",
                "lib/view/NodeView.js",
                "lib/view/ContentView.js",
                "lib/view/GenericView.js",
                //"lib/view/MenuManager.js",
                "lib/view/Window.js",

                "lib/view/browser/Browser.js",
                "lib/view/browser/BrowserColumn.js",
                "lib/view/browser/BrowserColumnGroup.js",
                "lib/view/browser/BrowserHeader.js",
                "lib/view/browser/BrowserHeaderAction.js",
                "lib/view/browser/BrowserRow.js",
                "lib/view/browser/BrowserRowNote.js",
                "lib/view/browser/BrowserRowSubtitle.js",
                "lib/view/browser/BrowserRowTitle.js",
                "lib/view/browser/BrowserFieldRow.js",
		        "lib/view/ImageWellView.js",
		        "lib/view/ImageView.js",
                
		        "view/BMDraftView.js",
		        "view/BMLetterView.js",
		        "view/BMMessageView.js",
		        "view/BMPostView.js",
		        "view/BMClassifiedPostView.js",
		        
                "model/market/BMBuy.js",
                "model/market/BMBuys.js",
                "model/market/BMRegion.js",
                "model/market/BMMarket.js",
                "model/market/BMPost.js",
                "model/market/BMSell.js",
                "model/market/BMSells.js",

                "model/market/BMClassifiedPost.js",
                "model/market/BMClassifiedPosts.js",

		        //"data.js",
		        //"DCMessage.js",
		        //"app.js"
		        
                "model/market/App.js",
		    ]
		
		    loadSequentialJS(files, function () {
		        sjcl.random.startCollectors();
		        

		        
		        /*
		        Browser.init(); 
		        var network = BMNetwork.clone()
		        network.servers().connect()
		        */
		        
		        App.shared()
		        
		        /*
		        var shaObj = new jsSHA("SHA-256", "TEXT");
                shaObj.update("This is a test");
                var hash = shaObj.getHash("HEX");
                console.log("hash = [" + hash + "]")
                */
		    })
		    
		    /*
		    function TestsRun() {
		        // wait until an ECIES javascript library that works in the browser is available
	            TestSHA();
		        TestElGamalEncryptDecrypt();
		        TestSig2();
		        TestSerializedKeys();
		    }
		    
		    function TestSHA() {
		        var shaBits = sjcl.hash.sha256.hash("test");
		        var shaHex = sjcl.codec.hex.fromBits(shaBits);
		        assert(shaHex == "9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08")		        
                console.log("TestSHA passed")
		    }
		    
		    function TestElGamalEncryptDecrypt() {
                var pair = sjcl.ecc.elGamal.generateKeys(256)
                var inputPlainText = "Hello World!"
                
                var cipherText = sjcl.encrypt(pair.pub, inputPlainText)
                var outputPlainText = sjcl.decrypt(pair.sec, cipherText)
		        assert(outputPlainText == inputPlainText)		        
                //console.log("encryption test cipherText: [" + cipherText + "]")
                console.log("encryption test outputPlainText: [" + outputPlainText + "]")
                console.log("TestSig TestElGamalEncryptDecrypt")
            }
            
            function TestSig() {
                // Must be ECDSA!
                var pair = sjcl.ecc.ecdsa.generateKeys(256)
                var inputPlainText = "Hello World!"
                
                var sig = pair.sec.sign(sjcl.hash.sha256.hash(inputPlainText))
                // [ 799253862, -791427911, -170134622, ... ]

                var ok = pair.pub.verify(sjcl.hash.sha256.hash(inputPlainText), sig)
                // Either `true` or an error will be thrown.
                assert(ok == true)		        
                console.log("TestSig passed")
            }
            
            function TestSig2() {
                // Must be ECDSA!
                var pair = sjcl.ecc.ecdsa.generateKeys(256)
                var inputPlainText = "Hello World!"
                var cipherText = sjcl.encrypt(pair.pub, inputPlainText)
                
                
                /*
                var sig = pair.sec.sign(sjcl.hash.sha256.hash(inputPlainText))
                // [ 799253862, -791427911, -170134622, ...

                var ok = pair.pub.verify(sjcl.hash.sha256.hash(inputPlainText), sig)
                // Either `true` or an error will be thrown.
                assert(ok == true)		        
                console.log("TestSig passed")
            }
            
            
            function TestSerializedKeys() {
                var pair = sjcl.ecc.elGamal.generateKeys(256);
                var pub = pair.pub.get();
                var sec = pair.sec.get();
                //var codec = sjcl.codec.z85;
                var codec = sjcl.codec.hex;
                
                // Serialized public key:
                var serializedPub = codec.fromBits(pub.x.concat(pub.y))
                console.log("serializedPub: [" + serializedPub + "]")
                
                // Unserialized public key:
                var unserializedPub = new sjcl.ecc.elGamal.publicKey(
                    sjcl.ecc.curves.c256, 
                    codec.toBits(serializedPub)
                )
                console.log("unserializedPub: [", unserializedPub, "]")
                //assert( unserializedPub.equals(pub) )         

                // Serialized private key:
                var serializedSec = codec.fromBits(sec)
                console.log("serializedSec: [" + serializedSec + "]")

                // Unserialized private key:
                var unserializedSec = new sjcl.ecc.elGamal.secretKey(
                    sjcl.ecc.curves.c256,
                    sjcl.ecc.curves.c256.field.fromBits(codec.toBits(serializedSec))
                )
                console.log("unserializedSec: [", unserializedSec, "]")
                //assert( unserializedSec.equals(sec) )         
            }
            */
            
        </script>
    


    </head>
      <body id="body">
        <div class="window">
          <div id="window-content" class="window-content">
          </div>
        </div>
      </body>
  
</html>
